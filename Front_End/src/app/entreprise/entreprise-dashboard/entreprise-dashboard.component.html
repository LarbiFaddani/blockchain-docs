<div class="layout">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">üîê</div>
      <div class="logo-text">
        <h2>DocsBlockchain</h2>
        <p>Espace Entreprise</p>
      </div>
    </div>

    <ul class="nav-menu">
      <li class="nav-item">
        <button
          class="nav-link"
          type="button"
          [class.active]="activePage === 'verification'"
          (click)="showPage('verification')">
          <span class="nav-icon">üîç</span>
          <span>V√©rification</span>
        </button>
      </li>

      <li class="nav-item">
        <button
          class="nav-link"
          type="button"
          [class.active]="activePage === 'profile'"
          (click)="showPage('profile')">
          <span class="nav-icon">üë§</span>
          <span>Mon Profil</span>
        </button>
      </li>
    </ul>

    <div class="user-section">
      <div class="user-info">
        <div class="user-avatar">{{ companyInitials }}</div>
        <div class="user-details">
          <h4>{{ companyName }}</h4>
          <p>{{ companyEmail }}</p>
        </div>
      </div>

      <button class="btn-logout" type="button" (click)="logout()">
        <span>D√©connexion</span>
      </button>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="main-content">
    <!-- PAGE: VERIFICATION -->
    <section *ngIf="activePage === 'verification'">
      <header class="header">
        <h1>V√©rification de Documents</h1>
        <p class="subtitle">V√©rifiez l'authenticit√© des documents sur la blockchain</p>
      </header>

      <div class="content">
        <div class="verification-container">

          <!-- Panel Upload -->
          <div class="panel">
            <div class="panel-header">
              <h2>üì§ Upload Document</h2>
              <p>Glissez-d√©posez ou s√©lectionnez un fichier √† v√©rifier</p>
            </div>

            <!-- Error banner -->
            <div class="banner error" *ngIf="errorMessage">
              <span class="b-ico">‚ö†Ô∏è</span>
              <span>{{ errorMessage }}</span>
            </div>

            <!-- Upload Zone -->
            <div
              class="upload-zone"
              [class.dragover]="isDragOver"
              (dragover)="onDragOver($event)"
              (dragleave)="onDragLeave($event)"
              (drop)="onDrop($event)"
              (click)="openFilePicker()"
              role="button"
              tabindex="0">

              <div class="upload-icon">üìÑ</div>
              <h3>Glissez-d√©posez votre fichier</h3>
              <p>ou cliquez pour parcourir</p>

              <button class="btn-upload" type="button" (click)="openFilePicker(); $event.stopPropagation()">
                Choisir un fichier
              </button>

              <p class="file-types">PDF, DOCX, PNG, JPG (Max 10MB)</p>

              <input
                #fileInput
                type="file"
                class="file-input"
                accept=".pdf,.docx,.png,.jpg,.jpeg"
                (change)="onFileSelected($event)" />
            </div>

            <!-- File preview -->
            <div class="uploaded-file" [class.show]="selectedFile">
              <div class="file-icon-display">üìã</div>
              <div class="file-info">
                <h4>{{ selectedFile?.name }}</h4>
                <p>{{ fileSizeLabel }}</p>
              </div>
              <button class="btn-remove" type="button" (click)="removeFile()">‚úï</button>
            </div>

            <!-- Verify button -->
            <button
              class="btn-verify"
              type="button"
              [class.show]="!!selectedFile"
              [disabled]="isVerifying || !selectedFile"
              (click)="verifyDocument()">
              {{ isVerifying ? 'V√©rification...' : 'üîç V√©rifier l‚Äôauthenticit√©' }}
            </button>
          </div>

          <!-- Panel Results -->
          <div class="panel">
            <div class="panel-header">
              <h2>üìä R√©sultats</h2>
              <p>Informations de v√©rification blockchain</p>
            </div>

            <!-- Empty -->
            <div class="results-empty" *ngIf="!isVerifying && !hasResult">
              <div class="empty-icon">üîç</div>
              <h3>En attente</h3>
              <p>Uploadez un document pour commencer</p>
            </div>

            <!-- Loading -->
            <div class="loading" [class.show]="isVerifying">
              <div class="spinner"></div>
              <p>V√©rification sur la blockchain...</p>
            </div>

            <!-- Results -->
            <div class="results-content" [class.show]="hasResult && !isVerifying" *ngIf="verifyResponse">
              <div class="status-header">
                <div class="status-icon" [class.verified]="isValid" [class.invalid]="!isValid">
                  {{ isValid ? '‚úì' : '‚úï' }}
                </div>

                <h2 [class.verified]="isValid" [class.invalid]="!isValid">
                  {{ isValid ? 'Document Authentique' : 'Document Non Authentique' }}
                </h2>

                <p class="status-msg">{{ verifyResponse.message }}</p>
              <button
                *ngIf="verifyResponse?.downloadUrl"
                class="btn-download"
                (click)="ddownload(verifyResponse.downloadUrl!)">
                ‚¨áÔ∏è T√©l√©charger le document
              </button>


              </div>
              

              <div class="info-card">
                <div class="info-row">
                  <span class="info-label">OrgId</span>
                  <span class="info-value">{{ verifyResponse.orgId ?? '‚Äî' }}</span>
                </div>
                <div class="info-row">
                  <span class="info-label">√âcole</span>
                  <span class="info-value">{{ ecoleDetails?.name }}</span>
                </div>


                <div class="info-row">
                  <span class="info-label">UserId</span>
                  <span class="info-value">{{ verifyResponse.userId ?? '‚Äî' }}</span>
                </div>

                <div class="info-row">
                  <span class="info-label">Type Document</span>
                  <span class="info-value">{{ verifyResponse.docType ?? '‚Äî' }}</span>
                </div>
              </div>

              <button class="btn-new" type="button" (click)="resetVerification()">
                üîÑ V√©rifier un autre document
              </button>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- PAGE: PROFIL -->
    <section *ngIf="activePage === 'profile'">
      <header class="header">
        <h1>Mon Profil</h1>
        <p class="subtitle">G√©rez les informations de votre entreprise</p>
      </header>

      <div class="content">
        <div class="profile-container">
          <div class="profile-card">
            <div class="profile-header">
              <div class="profile-avatar">{{ companyInitials }}</div>
              <div class="profile-info">
                <h2>{{ companyName }}</h2>
                <p>{{ companyEmail }}</p>
              </div>
            </div>

            <div class="results-empty">
              <div class="empty-icon">üë§</div>
              <h3>Profil (√† connecter)</h3>
              <p>Branche ici ton service entreprise + formulaire (update profil).</p>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>
